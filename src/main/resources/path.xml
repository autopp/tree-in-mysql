<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="tree.PathDivisionMapper">
  <select id="getPathOf" resultType="java.lang.String">
    SELECT path FROM division_path WHERE id = #{id};
  </select>
  <insert id="addDivision" parameterType="tree.PathDivisionRepository$PathDivision">
    INSERT INTO division_path (id, path) VALUES (#{id}, #{path});
  </insert>
  <select id="getDescendantsOf" resultType="java.lang.Integer" parameterType="tree.PathDivisionRepository$PathDivision">
    SELECT other.id FROM division_path AS other
      INNER JOIN division_path AS own ON own.id = #{id}
      WHERE other.path LIKE CONCAT(own.path, '%') AND other.id != #{id};
  </select>
</mapper>
